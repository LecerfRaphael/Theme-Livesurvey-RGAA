## Comparatif version de base / version améliorée – Pack accessibilité LimeSurvey

---

### 1. Structure de page : rôle `main` / `header`

**Version de base**  
Le contenu principal est dans un `<article>` sans rôle explicite, le header de la nav n’est pas clairement structuré.

**Version améliorée**  
Tu introduis `<header role="banner">` et `<main role="main">`. Le contenu du questionnaire est clairement identifié comme zone principale.

**Références RGAA / WCAG**  
- **RGAA 9.1 / 6.1.1** – zones de page repérables  
- **WCAG 2.0 – 1.3.1 / 2.4.1** (landmarks)

---

### 2. Titre de page dynamique (meta `<title>`)

**Version de base**  
Le `<title>` est statique : « Enquête recensemment… (test finalisation template) ». Aucun lien avec la page courante ni le groupe affiché.

**Version améliorée**  
Script JS qui recalcule `document.title` :  
« Enquête recensement et cartographie RAN — Page X / Y », en récupérant le nom de l’enquête et du groupe. Mise à jour aussi des metas OpenGraph / Twitter.

**Références RGAA / WCAG**  
- **RGAA 8.9 / 8.10** – titres de pages pertinents  
- **WCAG 2.4.2 Page Titled**

---

### 3. Titre visuel de page (`ls-page-title`)

**Version de base**  
Le H1 de groupe est géré par le thème, mais sans indication du numéro de page dans l’enchaînement global (ou alors sans cohérence).

**Version améliorée**  
Script qui recalcule le H1 : « Enquête… — Page 1 / 1 » en analysant l’index des questions / valeurs `move`. Meilleure compréhension pour tous, y compris lecteurs d’écran.

**Références RGAA / WCAG**  
- **RGAA 9.1 / 8.10**  
- **WCAG 2.4.2 / 2.4.6**

---

### 4. Index des questions (menu de navigation)

**Version de base**  
Lien `<a class="dropdown-toggle">` sans texte caché supplémentaire ni `sr-only`. Toggler mobile sans indication vocale (« Menu » absent).

**Version améliorée**  
Tu transformes l’index en  
`<button class="btn-nostyle dropdown-toggle nav-link">`  
+ ajout d’un `<span class="sr-only">Menu</span>` dans le toggler.  
Comportement plus clair pour lecteurs d’écran, activation clavier mieux cadrée.

**Références RGAA / WCAG**  
- **RGAA 9.2 / 9.3**  
- **WCAG 2.1.1 Keyboard**, 2.4.7 Focus Visible

---

### 5. Texte obligatoire / astérisque

**Version de base**  
Astérisque + phrase « (Cette question est obligatoire) » dans un  
`<span class="visually-hidden">` – déjà correct, mais répété dans chaque bloc avec un H2/H3 plutôt verbeux.

**Version améliorée**  
Tu gardes le couple astérisque + `span.visually-hidden`, mais tu ajoutes un rappel global dans le groupe : `<sup>` + « question obligatoire ».  
Le pattern est plus lisible, évite la redondance textuelle.

**Références RGAA / WCAG**  
- **RGAA 8.2 / 11.1**  
- **WCAG 3.3.2 Labels or Instructions**

---

### 6. Questions textuelles : `label` vs `div`

**Version de base**  
Texte de question dans :  
`<div class="question-title-container"><div class="ls-label-question">…</div>`  
et input avec `aria-labelledby`.  
Pas de vrai `<label for="…">` direct : dépend du couplage ARIA.

**Version améliorée**  
Tu remplaces par un vrai :  
`<label class="ls-label-question" for="answer…">` (le `id` de l’input),  
qui joue le rôle à la fois visuel et programmatique.  
ARIA `aria-labelledby` reste cohérent.

**Références RGAA / WCAG**  
- **RGAA 11.1** – chaque champ a une étiquette  
- **WCAG 1.3.1 / 3.3.2**

---

### 7. Structure des questions (`fieldset` / `legend`)

**Version de base**  
Questions sous forme de `div.question-container` avec sous-blocs internes.  
Pour les listes radio, le « titre » est dans un bloc `div` séparé, pas dans un `legend`.

**Version améliorée**  
Tu appliques un script générique : transformation de  
`div.list-radio`, `div.multiple-opt`, `div.numeric-multi`, `div.date`, etc.  
en :  
`<fieldset class="question-container …">`  
+ `<legend class="ls-label-question">`.  
Structuration sémantique complète.

**Références RGAA / WCAG**  
- **RGAA 9.2**  
- **WCAG 1.3.1** – relations logiques & regroupements de champs

---

### 8. Messages d’aide / erreurs (`question-valid-container`)

**Version de base**  
Les messages d’erreur / aide sont dans `div.question-valid-container` avec `role="alert"` sur `.ls-questionhelp`, même quand il s’agit de simples tips.  
Risque de verbosité « alerte » pour JAWS / NVDA.

**Version améliorée**  
Script qui retire `role="alert"` et convertit en `aria-live="polite"` ;  
suppression des `question-valid-container` superflus.  
Les aides deviennent des messages d’information, pas des alertes intempestives.

**Références RGAA / WCAG**  
- **RGAA 7.1 / 7.2**  
- **WCAG 3.3.1 Error Identification**, 4.1.3 Status Messages

---

### 9. Conditionnel / pertinence (`ls-irrelevant` / `ls-hidden`)

**Version de base**  
Quand une question redevient pertinente, l’Expression Manager enlève `ls-irrelevant` mais laisse parfois `ls-hidden` / `hidden` / `display:none`, ce qui bloque la navigation pour clavier / lecteur d’écran.

**Version améliorée**  
Script 4f) : `unhideIfRelevant(q)` enlève `ls-hidden`, `hidden`, `display:none` dès que la question redevient pertinente (sauf si marquée `data-ls-manual-hide="1"`).  
Les questions conditionnelles redeviennent visibles correctement.

**Références RGAA / WCAG**  
- **RGAA 10.7 / 12.13**  
- **WCAG 1.3.1** (contenu contrôlé par scripts) & 2.1.1

---

### 10. Questions « Si oui… » (logique conditionnelle lisible)

**Version de base**  
Logique de pertinence gérée uniquement via EM (conditions internes).  
Pas de cohérence sémantique explicite entre la question mère (« Oui / Non ») et la question fille (qui suit).

**Version améliorée**  
Script 4g) :  
- détection des `legend` commençant par « Si oui »  
- recherche de la question parente juste au-dessus  
- écoute des radios « Oui »  
- masquage / ré-affichage propre de la question fille, avec nettoyage des réponses si masquée.

**Références RGAA / WCAG**  
- **RGAA 10.7**  
- **WCAG 3.2.2 On Input** – changements de contexte prévisibles + 3.3.2

---

### 11. Required conditionnel (visibilité / pertinence)

**Version de base**  
Champs dans des questions `mandatory` restent parfois `required` même si cachés (cas `.ls-hidden`, conditionnels, `othertext`, etc.), ce qui bloque la validation.

**Version améliorée**  
Bloc 4) : plusieurs scripts qui gèrent `required` uniquement sur questions visibles :  
- text-short / text-long  
- list-radio  
- tableaux `.ls-table-wrapper`  
- multiple-opt, etc.  
Nettoyage des champs masqués.

**Références RGAA / WCAG**  
- **RGAA 11.1 / 10.7**  
- **WCAG 3.3.1 / 3.3.3** – erreurs identifiées et formulaires utilisables

---

### 12. Entrées « Autre : » (`othertext`)

**Version de base**  
Champ « Autre : » a parfois un `required` ou influence la validation de façon bancale (obligatoire même sans choix « Autre »).

**Version améliorée**  
Nettoyage du `required` sur `.ls-js-hidden input.othertext`  
+ logique : le message « préciser le champ ‘Autre’ » ne s’active que si l’option `-oth-` est sélectionnée et que le champ texte est vide.

**Références RGAA / WCAG**  
- **RGAA 11.1**  
- **WCAG 3.3.2** – étiquettes & aides adaptées

---

### 13. Champs numériques / type de clavier (mobile)

**Version de base**  
Tous les champs sont en `type="text"` même pour numérique, téléphone, mail, date ; limite l’ergonomie clavier virtuel et les contrôles natifs.

**Version améliorée**  
Script 6) : conversion auto en `type="email"`, `type="tel"`, `type="number"`, `type="date"` selon classe du fieldset (`.email`, `.tel`, `.num`, `.numeric`, `.date`), avec gestion d’`inputmode` / placeholder.

**Références RGAA / WCAG**  
- **RGAA 7.5**  
- **WCAG 2.1.1 / 2.5.1** – facilité d’usage au clavier & sur mobile

---

### 14. Champs date : trio jour/mois/année + input caché

**Version de base**  
Input `type="date"` masqué + selects jour/mois/année, mais liaison parfois fragile, validations peu explicites ; risque de focus sur le champ caché en cas d’erreur.

**Version améliorée**  
Bloc 1) : script qui  
- synchronise selects J/M/A vers l’`input[type=date]` caché  
- enlève `required` sur ce dernier  
- gère le focus vers le premier select vide en cas d’erreur  
- ajoute des placeholders Jour / Mois / Année.

**Références RGAA / WCAG**  
- **RGAA 3.2 / 11.1**  
- **WCAG 1.3.1 / 3.3.1** – sens conservé, erreurs identifiables

---

### 15. Callout JS désactivé

**Version de base**  
Message JS déjà présent (« JavaScript désactivé… »), mais l’impact sur le fonctionnement n’est pas clarifié, et pas forcément mis à jour avec les évolutions.

**Version améliorée**  
Le message est conservé ; ton pack ajoute des scripts mais tu veilles à ce que la structure HTML reste fonctionnelle sans JS (labels, fieldsets, required côté serveur, etc.).  
L’expérience est dégradée mais utilisable.

**Références RGAA / WCAG**  
- **RGAA 8.9 / 13.1**  
- **WCAG 1.3.1 / 2.1.1** – fonctionnement sans script

---

### 16. Visibilité des pickers calendrier

**Version de base**  
Pickers graphiques (`.input-group-addon i.fa-calendar`, widgets tempus dominus) peuvent introduire du bruit et des pièges de navigation pour lecteurs d’écran.

**Version améliorée**  
Bloc 5) : masquage des `.input-group-addon` avec icône calendrier et des widgets `.tempus-dominus-widget`, `.date-container`.  
Reste la saisie via selects ou champs date.

**Références RGAA / WCAG**  
- **RGAA 7.5 / 10.7**  
- **WCAG 2.1.1 / 2.4.3** – suppression de contrôles redondants / confus

---

### 17. Hiérarchie des titres / légendes de groupe

**Version de base**  
Groupes : titre « Identification » dans un `<div class="group-title h3">` sans relation forte avec la page / structure globale.

**Version améliorée**  
`<fieldset>` de groupe avec  
`<legend class="group-title h3">Identification</legend>`,  
H1 distinct pour le titre général + page.  
Hiérarchie claire : H1 (enquête/page), legend (bloc de questions).

**Références RGAA / WCAG**  
- **RGAA 9.1 / 9.2**  
- **WCAG 1.3.1 / 2.4.6**

---

### 18. Compatibilité lecteur d’écran : texte d’aide et messages d’erreur

**Version de base**  
Messages d’erreurs sont parfois trop nombreux, annoncés comme `role="alert"`, avec peu de distinction entre aide, astuce et erreur réelle.

**Version améliorée**  
Tu standardises les `.ls-questionhelp` en infos non bloquantes (`aria-live="polite"`), et les vrais cas d’erreurs restent gérés par la validation EM.  
Résultat : synthèse vocale moins saturée.

**Références RGAA / WCAG**  
- **RGAA 7.1 / 7.2**  
- **WCAG 3.3.1**

---

### 19. Gestion dynamique des questions dans les tableaux

**Version de base**  
Tables d’items (`.ls-table-wrapper`) : validation EM exige parfois une réponse par ligne mais sans véritable couplage `required` HTML.

**Version améliorée**  
Script de validation par ligne (4b) qui ajoute ou enlève `required` en fonction de la sélection au niveau de chaque ligne.  
Meilleure cohérence client / serveur.

**Références RGAA / WCAG**  
- **RGAA 11.1**  
- **WCAG 3.3.1 / 3.3.3**
